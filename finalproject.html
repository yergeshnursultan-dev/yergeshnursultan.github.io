<!DOCTYPE html>
<html lang="kk">
<head>
<meta charset="UTF-8" />
<title>Solar Space ‚Äî –ö“Ø–Ω —Ç”ô–∂–¥—ñ–∫ –º–∞—Å—Å–∞—Å—ã –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞—Å—ã ‚òÄÔ∏è</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
  :root {
    --accent: #ffbf00;
    --accent-soft: rgba(255, 191, 0, 0.12);
    --bg-deep: #020312;
    --card-bg: rgba(10, 16, 40, 0.9);
    --border-soft: rgba(148, 163, 184, 0.4);
  }

  * { box-sizing: border-box; }

  body {
    margin: 0;
    font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    color: #e5e7eb;
    background:
      radial-gradient(circle at top, rgba(56, 189, 248, 0.25), transparent 55%),
      radial-gradient(circle at bottom, rgba(34, 197, 94, 0.18), transparent 60%),
      radial-gradient(circle at center, #020617, #020312 70%);
    min-height: 100vh;
  }

  header {
    max-width: 1200px;
    margin: 0 auto;
    padding: 18px 20px 8px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 16px;
  }

  .brand { display: flex; align-items: center; gap: 10px; }

  .brand-logo {
    width: 32px; height: 32px; border-radius: 999px;
    background: radial-gradient(circle at 30% 30%, #fde68a, #f97316 55%, #b91c1c 85%);
    box-shadow: 0 0 18px rgba(251, 191, 36, 0.8);
  }

  .brand-name {
    font-weight: 700;
    letter-spacing: 0.03em;
    font-size: 1rem;
  }

  nav {
    display: flex;
    gap: 16px;
    font-size: 0.85rem;
    opacity: 0.9;
  }
  nav span { cursor: default; }

  .badge-pro {
    padding: 4px 10px;
    border-radius: 999px;
    font-size: 0.75rem;
    border: 1px solid rgba(52, 211, 153, 0.7);
    background: rgba(16, 185, 129, 0.12);
    color: #6ee7b7;
  }

  .hero {
    max-width: 1200px;
    margin: 0 auto;
    padding: 6px 20px 12px;
    display: grid;
    grid-template-columns: minmax(0, 2fr) minmax(0, 1.4fr);
    gap: 24px;
    align-items: center;
  }
  @media (max-width: 900px) {
    .hero { grid-template-columns: 1fr; }
  }

  .hero-left-title {
    font-size: 2rem;
    font-weight: 800;
    line-height: 1.1;
  }

  .hero-left-title span.accent {
    background: linear-gradient(135deg, #facc15, #f97316);
    -webkit-background-clip: text;
    color: transparent;
  }

  .hero-sub {
    margin-top: 8px;
    font-size: 0.95rem;
    opacity: 0.9;
    max-width: 520px;
  }

  .hero-cta-row {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    margin-top: 16px;
    align-items: center;
  }

  .btn-primary {
    border: none;
    border-radius: 999px;
    padding: 10px 18px;
    font-size: 0.9rem;
    font-weight: 600;
    background: linear-gradient(135deg, #f97316, #fbbf24);
    color: #0f172a;
    cursor: pointer;
    box-shadow: 0 12px 30px rgba(248, 181, 0, 0.55);
    display: inline-flex;
    align-items: center;
    gap: 6px;
  }
  .btn-primary:hover {
    filter: brightness(1.05);
    transform: translateY(-1px);
  }

  .hero-small-note {
    font-size: 0.8rem;
    opacity: 0.8;
  }

  .upload-card {
    margin-top: 10px;
    padding: 14px 16px;
    border-radius: 16px;
    background: rgba(15, 23, 42, 0.9);
    border: 1px solid rgba(148, 163, 184, 0.5);
    display: inline-flex;
    flex-wrap: wrap;
    gap: 10px;
    align-items: center;
  }

  input[type="file"] { font-size: 0.8rem; }

  .status-pill {
    min-width: 150px;
    font-size: 0.8rem;
    padding: 5px 10px;
    border-radius: 999px;
    background: rgba(15, 23, 42, 0.95);
    border: 1px solid rgba(148, 163, 184, 0.6);
    display: inline-flex;
    align-items: center;
    gap: 6px;
  }
  .status-dot {
    width: 9px; height: 9px; border-radius: 999px; background: #9ca3af;
  }
  .status-pill.ready .status-dot { background: #22c55e; }
  .status-pill.loading .status-dot {
    background: #eab308;
    animation: pulse 1s infinite alternate;
  }
  .status-pill.error .status-dot { background: #ef4444; }
  @keyframes pulse {
    from { transform: scale(0.8); opacity: 0.6; }
    to   { transform: scale(1.1); opacity: 1; }
  }

  .main-layout {
    max-width: 1200px;
    margin: 6px auto 40px;
    padding: 0 20px 20px;
    display: grid;
    grid-template-columns: minmax(0, 1.5fr) minmax(0, 1.2fr);
    gap: 20px;
  }
  @media (max-width: 1024px) {
    .main-layout { grid-template-columns: 1fr; }
  }

  .card {
    background: var(--card-bg);
    border-radius: 18px;
    padding: 16px 18px;
    border: 1px solid var(--border-soft);
  }

  .card-title {
    font-size: 0.95rem;
    font-weight: 600;
    margin-bottom: 6px;
  }

  .card-sub {
    font-size: 0.8rem;
    opacity: 0.8;
    margin-bottom: 8px;
  }

  /* –ö“Ø–Ω –∞–Ω–∏–º–∞—Ü–∏—è—Å—ã */
  #sun-system {
    position: relative;
    width: 260px;
    height: 260px;
    margin: 8px auto 4px;
  }

  #sun, #corona, #flare, #orbit-particles {
    position: absolute;
    border-radius: 50%;
    transition: 0.12s;
  }

  #sun {
    width: 160px;
    height: 160px;
    top: 50px;
    left: 50px;
    background: radial-gradient(circle at 30% 30%, #fef9c3, #f97316 60%, #b91c1c 85%);
    box-shadow: 0 0 40px rgba(248, 181, 0, 0.9);
    animation: sun-pulse 2.8s infinite ease-in-out;
    overflow: hidden;
  }

  #corona {
    width: 160px;
    height: 160px;
    top: 50px;
    left: 50px;
    background: radial-gradient(circle, rgba(255, 200, 80, 0.45), transparent 70%);
    animation: corona-pulse 3.4s infinite ease-in-out;
  }

  #flare {
    width: 240px;
    height: 240px;
    top: 10px;
    left: 10px;
    pointer-events: none;
    background: radial-gradient(circle, rgba(248, 113, 113, 0.0), transparent 75%);
    mix-blend-mode: screen;
  }

  #orbit-particles {
    width: 260px;
    height: 260px;
    top: 0;
    left: 0;
    border-radius: 50%;
    border: 1px dashed rgba(148, 163, 184, 0.25);
    animation: orbit-rotate 14s linear infinite;
    background:
      radial-gradient(circle at 90% 20%, rgba(248, 250, 252, 0.4), transparent 60%),
      radial-gradient(circle at 10% 80%, rgba(248, 250, 252, 0.25), transparent 55%);
    opacity: 0.5;
  }

  @keyframes sun-pulse {
    0%,100% { transform: scale(1); }
    50% { transform: scale(1.03); }
  }
  @keyframes corona-pulse {
    0%,100% { transform: scale(1); opacity: 0.9; }
    50% { transform: scale(1.07); opacity: 1; }
  }
  @keyframes orbit-rotate {
    from { transform: rotate(0deg); }
    to   { transform: rotate(360deg); }
  }

  .year-label {
    text-align: center;
    font-size: 0.85rem;
    margin-top: 4px;
    color: #fde68a;
  }
  .region-label {
    text-align: center;
    font-size: 0.8rem;
    margin-top: 2px;
    color: #e5e7eb;
  }

  .controls-row {
    margin-top: 10px;
    display: flex;
    justify-content: center;
    gap: 8px;
    flex-wrap: wrap;
  }

  .btn-ghost {
    border-radius: 999px;
    padding: 6px 12px;
    border: 1px solid rgba(148, 163, 184, 0.6);
    background: rgba(15, 23, 42, 0.9);
    color: #e5e7eb;
    font-size: 0.8rem;
    cursor: pointer;
  }
  .btn-ghost:hover {
    background: rgba(30, 64, 175, 0.8);
  }

  #results { font-size: 0.8rem; margin-top: 8px; }
  #results p { margin: 3px 0; }

  .pill-highlight {
    display: inline-flex;
    padding: 3px 9px;
    border-radius: 999px;
    background: rgba(8, 47, 73, 0.9);
    border: 1px solid rgba(56, 189, 248, 0.7);
    font-size: 0.75rem;
    gap: 4px;
    align-items: center;
  }

  .charts-grid {
    display: grid;
    grid-template-columns: minmax(0, 1fr);
    gap: 14px;
  }

  .chart-wrapper {
    background: radial-gradient(circle at top left, rgba(56, 189, 248, 0.15), transparent 55%);
    border-radius: 16px;
    padding: 10px 10px 6px;
    border: 1px solid rgba(148, 163, 184, 0.35);
  }

  .chart-header {
    display: flex;
    justify-content: space-between;
    font-size: 0.8rem;
    margin-bottom: 4px;
    opacity: 0.9;
  }

  canvas {
    width: 100%;
    height: 190px;
    border-radius: 10px;
    background: #020617;
  }

  /* -------- –ö“Ø–Ω –º–∞–∫–µ—Ç—ñ —Ñ–æ–Ω—ã + —Ç–æ—Ä –±–∞“ì—ã—Ç—Ç–∞“ì—ã –≥—Ä–∞—Ñ–∏–∫ -------- */
  .sun-model {
    margin-top: 12px;
    border-radius: 18px;
    padding: 14px 14px 12px;
    background: radial-gradient(circle at top, rgba(248, 250, 252, 0.06), transparent 70%);
    border: 1px dashed rgba(148, 163, 184, 0.5);
    font-size: 0.8rem;
  }

  .sun-model-title {
    font-weight: 600;
    font-size: 0.85rem;
    margin-bottom: 4px;
  }

  .sun-map-wrapper {
    position: relative;
    margin: 8px auto 6px;
    width: 220px;
    max-width: 100%;
    aspect-ratio: 1 / 1;
    border-radius: 50%;
    overflow: hidden;
    background:
      radial-gradient(circle at center, rgba(249,115,22,0.95) 0, rgba(15,23,42,1) 60%);
    padding: 10px;
    box-shadow: 0 0 22px rgba(249,115,22,0.5);
  }

  #sunRegionMap {
    width: 100% !important;
    height: 100% !important;
    background: radial-gradient(circle at center, rgba(15,23,42,0.4), transparent 70%);
  }

  .sun-quadrant-label {
    position: absolute;
    font-size: 0.7rem;
    opacity: 0.95;
    text-shadow: 0 0 4px rgba(0,0,0,0.8);
  }
  .sun-q-top {
    top: 4px;
    left: 50%;
    transform: translateX(-50%);
  }
  .sun-q-bottom {
    bottom: 4px;
    left: 50%;
    transform: translateX(-50%);
  }
  .sun-q-left {
    left: 4px;
    top: 50%;
    transform: translateY(-50%);
  }
  .sun-q-right {
    right: 4px;
    top: 50%;
    transform: translateY(-50%);
  }

  .sun-map-axes-label {
    text-align: center;
    font-size: 0.75rem;
    opacity: 0.85;
    margin-top: 2px;
  }

  .sun-model-caption {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 8px;
    margin-top: 4px;
  }

  .legend-item {
    display: inline-flex;
    align-items: center;
    gap: 4px;
    font-size: 0.75rem;
  }

  .legend-dot {
    width: 8px; height: 8px; border-radius: 999px;
  }

  /* -------- –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä + –ñ–ò –±–æ–ª–∂–∞–º –±–ª–æ–∫—Ç–∞—Ä—ã -------- */
  .calc-block {
    margin-top: 14px;
    padding: 10px 12px;
    border-radius: 14px;
    border: 1px solid rgba(148,163,184,0.6);
    background: rgba(15,23,42,0.9);
    font-size: 0.8rem;
  }

  .calc-block-title {
    font-weight: 600;
    margin-bottom: 6px;
    font-size: 0.85rem;
  }

  .calc-row {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    margin-bottom: 6px;
  }

  .calc-row label {
    display: flex;
    flex-direction: column;
    gap: 2px;
    font-size: 0.75rem;
  }

  .calc-row input {
    background: #020617;
    border-radius: 8px;
    border: 1px solid rgba(148,163,184,0.7);
    padding: 4px 6px;
    color: #e5e7eb;
    font-size: 0.8rem;
    min-width: 80px;
  }

  .calc-result {
    margin-top: 4px;
    font-size: 0.8rem;
  }

  .ai-forecast {
    margin-top: 12px;
    padding: 12px 14px;
    border-radius: 16px;
    border: 1px solid rgba(96,165,250,0.9);
    background:
      radial-gradient(circle at top left, rgba(59,130,246,0.3), transparent 60%),
      radial-gradient(circle at bottom right, rgba(8,47,73,0.7), rgba(15,23,42,1));
    font-size: 0.8rem;
    box-shadow: 0 12px 26px rgba(15,23,42,0.8);
  }

  .ai-forecast-title {
    font-weight: 600;
    margin-bottom: 6px;
    font-size: 0.9rem;
    display: flex;
    gap: 6px;
    align-items: center;
  }

  .ai-chip {
    display: inline-flex;
    align-items: center;
    gap: 4px;
    font-size: 0.7rem;
    padding: 2px 8px;
    border-radius: 999px;
    background: rgba(15,23,42,0.7);
    border: 1px solid rgba(148,163,184,0.7);
  }

  .ai-metrics-row {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    margin: 4px 0 8px;
  }

  .ai-metric {
    font-size: 0.75rem;
    padding: 4px 8px;
    border-radius: 8px;
    background: rgba(15,23,42,0.7);
    border: 1px solid rgba(107,114,128,0.7);
  }

  .ai-forecast-body {
    font-size: 0.8rem;
    opacity: 0.92;
    line-height: 1.4;
  }
</style>
</head>
<body>
<header>
  <div class="brand">
    <div class="brand-logo"></div>
    <div>
      <div class="brand-name">Solar Space</div>
      <div style="font-size:0.75rem;opacity:0.7;">Coronal Mass Ejection Analytics</div>
    </div>
  </div>
  <nav>
    <span>–§—É–Ω–∫—Ü–∏—è–ª–∞—Ä</span>
    <span>–ê–Ω–∞–ª–∏—Ç–∏–∫–∞</span>
    <span>–ö–æ–Ω—Ç–∞–∫—Ç</span>
    <span class="badge-pro">Research Edition</span>
  </nav>
</header>

<section class="hero">
  <div>
    <div class="hero-left-title">
      –ö“Ø–Ω–Ω—ñ“£ <span class="accent">—Ç”ô–∂–¥—ñ–∫ –º–∞—Å—Å–∞—Å—ã–Ω</span><br/>
      –≤–∏–∑—É–∞–ª–¥—ã —Ç–∞–ª–¥–∞—É –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞—Å—ã
    </div>
    <div class="hero-sub">
      SME —Ñ–æ—Ä–º–∞—Ç—ã–Ω–¥–∞“ì—ã TXT —Ñ–∞–π–ª–¥—ã –∂”ô–Ω–µ X_CME.txt —Ñ–∞–π–ª–¥—ã –∂“Ø–∫—Ç–µ–ø, —Ç”ô–∂–¥—ñ–∫ –º–∞—Å—Å–∞,  
      –∫–∏–Ω–µ—Ç–∏–∫–∞–ª—ã“õ —ç–Ω–µ—Ä–≥–∏—è, –∂—ã–ª–¥–∞–º–¥—ã“õ, –∞—É—ã—Ç“õ—É, –∫–µ—à—ñ–≥—É –∂”ô–Ω–µ –ö“Ø–Ω –±–µ—Ç—ñ–Ω—ñ“£ “õ–∞–π  
      –±”©–ª—ñ–∫—Ç–µ—Ä—ñ–Ω–¥–µ –∂–∏—ñ –±–æ–ª–∞—Ç—ã–Ω—ã–Ω –∑–µ—Ä—Ç—Ç–µ.
    </div>
    <div class="hero-cta-row">
      <button class="btn-primary" onclick="document.getElementById('fileInput').click()">
        üî≠ –î–µ—Ä–µ–∫—Ç—ñ –∂“Ø–∫—Ç–µ–ø –±–∞—Å—Ç–∞—É
      </button>
      <div class="hero-small-note">
        1996‚Äì2025 –∞—Ä–∞–ª—ã“ì—ã–Ω–¥–∞“ì—ã –ö“Ø–Ω CME –¥–µ—Ä–µ–∫—Ç–µ—Ä—ñ “Ø—à—ñ–Ω —ã“£“ì–∞–π–ª—ã.  
        –ë“±–ª ‚Äî “ì—ã–ª—ã–º–∏ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è–ª—ã“õ “õ“±—Ä–∞–ª, –Ω–∞“õ—Ç—ã –±–æ–ª–∂–∞“ì—ã—à –µ–º–µ—Å.
      </div>
    </div>
    <div class="upload-card">
      <div style="display:flex;flex-direction:column;gap:4px;font-size:0.8rem;">
        <label>SME –¥–µ—Ä–µ–≥—ñ (–Ω–µ–≥—ñ–∑–≥—ñ TXT): <input type="file" id="fileInput" /></label>
        <label>X_CME –¥–µ—Ä–µ–≥—ñ (–∫–µ—à—ñ–≥—É, –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç): <input type="file" id="xCmeInput" /></label>
      </div>
      <button class="btn-ghost" onclick="loadData()">–§–∞–π–ª–¥–∞—Ä–¥—ã ”©“£–¥–µ—É</button>
      <div id="statusMessage" class="status-pill">
        <span class="status-dot"></span>
        <span id="statusText">–§–∞–π–ª–¥–∞—Ä —Ç–∞“£–¥–∞–ª–º–∞–¥—ã</span>
      </div>
    </div>
  </div>

  <div class="card">
    <div class="card-title">–ö“Ø–Ω –∞–Ω–∏–º–∞—Ü–∏—è—Å—ã</div>
    <div class="card-sub">
      –ú–∞—Å—Å–∞, —ç–Ω–µ—Ä–≥–∏—è –∂”ô–Ω–µ –∂—ã–ª–¥–∞–º–¥—ã“õ –±–æ–π—ã–Ω—à–∞ –ö“Ø–Ω–Ω—ñ“£ —Ç“Ø—Å—ñ, –∫–æ—Ä–æ–Ω–∞—Å—ã  
      –º–µ–Ω –∂–∞—Ä“õ—ã—Ä–∞—É—ã ”©–∑–≥–µ—Ä–µ–¥—ñ. –ë“±–ª ‚Äî –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è, “Ø—Å—Ç—ñ—Ä—Ç –º–æ–¥–µ–ª—å.
    </div>
    <div id="sun-system">
      <div id="orbit-particles"></div>
      <div id="flare"></div>
      <div id="corona"></div>
      <div id="sun"></div>
    </div>
    <div class="year-label">
      –£–∞“õ—ã—Ç (–∂—ã–ª): <span id="yearShow">‚Äì</span>
    </div>
    <div class="region-label">
      –ö“Ø–Ω–Ω—ñ“£ –∞“ì—ã–º–¥–∞“ì—ã –±”©–ª—ñ–≥—ñ: <span id="regionText">‚Äî</span>
    </div>
    <div class="controls-row">
      <button class="btn-ghost" onclick="play()">‚ñ∂ –û–π–Ω–∞—Ç—É</button>
      <button class="btn-ghost" onclick="pause()">‚è∏ –¢–æ“õ—Ç–∞—Ç—É</button>
      <button class="btn-ghost" onclick="resetAnim()">üîÑ “ö–∞–π—Ç–∞ –±–∞—Å—Ç–∞—É</button>
    </div>
    <div id="results"></div>
  </div>
</section>

<main class="main-layout">
  <div class="card">
    <div class="card-title">–ì—Ä–∞—Ñ–∏–∫—Ç–µ—Ä</div>
    <div class="card-sub">
      –¢”ô–∂–¥—ñ–∫ –º–∞—Å—Å–∞, –∫–∏–Ω–µ—Ç–∏–∫–∞–ª—ã“õ —ç–Ω–µ—Ä–≥–∏—è, —Å—ã–∑—ã“õ—Ç—ã“õ –∂—ã–ª–¥–∞–º–¥—ã“õ, –∞—É—ã—Ç“õ—É,  
      –∂–∞—Ä—ã“õ—Ç–∞–ª—É –∏–Ω—Ç–µ–Ω—Å–∏–≤—Ç—ñ–ª—ñ–≥—ñ –º–µ–Ω –∫–µ—à—ñ–≥—É, —Å–æ–Ω–¥–∞–π-–∞“õ –ö“Ø–Ω –±–µ—Ç—ñ–Ω—ñ“£ “õ–∞–π  
      –±”©–ª—ñ–∫—Ç–µ—Ä—ñ –±–µ–ª—Å–µ–Ω–¥—ñ—Ä–µ–∫ –µ–∫–µ–Ω—ñ–Ω –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤—Ç—ñ —Ç“Ø—Ä–¥–µ “õ–∞—Ä–∞—É.
    </div>

    <div class="charts-grid">
      <div class="chart-wrapper">
        <div class="chart-header">
          <span>–¢”ô–∂–¥—ñ–∫ –º–∞—Å—Å–∞</span><span>M(t)</span>
        </div>
        <canvas id="chartMass"></canvas>
      </div>

      <div class="chart-wrapper">
        <div class="chart-header">
          <span>–ö–∏–Ω–µ—Ç–∏–∫–∞–ª—ã“õ —ç–Ω–µ—Ä–≥–∏—è</span><span>E<sub>kin</sub>(t)</span>
        </div>
        <canvas id="chartKE"></canvas>
      </div>

      <div class="chart-wrapper">
        <div class="chart-header">
          <span>–°—ã–∑—ã“õ—Ç—ã“õ –∂—ã–ª–¥–∞–º–¥—ã“õ</span><span>V(t)</span>
        </div>
        <canvas id="chartSpeed"></canvas>
      </div>

      <div class="chart-wrapper">
        <div class="chart-header">
          <span>–¢”ô–∂–¥—ñ–∫ –º–∞—Å—Å–∞–Ω—ã“£ –∞—É—ã—Ç“õ—É—ã</span><span>M ‚àí ‚ü®M‚ü©</span>
        </div>
        <canvas id="chartMassDev"></canvas>
      </div>

      <div class="chart-wrapper">
        <div class="chart-header">
          <span>–ö–µ—à—ñ–≥—É –≥—Ä–∞—Ñ–∏–≥—ñ</span><span>Œît vs I</span>
        </div>
        <canvas id="chartCorr"></canvas>
      </div>

      <div class="chart-wrapper">
        <div class="chart-header">
          <span>–ö“Ø–Ω –±–µ—Ç—ñ–Ω—ñ“£ –±”©–ª—ñ–∫—Ç–µ—Ä—ñ</span>
          <span>–°–æ–ª—Ç/–û“£—Ç/–®—ã“ì—ã—Å/–ë–∞—Ç—ã—Å/–û—Ä—Ç–∞–ª—ã“õ</span>
        </div>
        <canvas id="chartForecast"></canvas>
      </div>
    </div>
  </div>

  <div class="card">
    <div class="card-title">–ö“Ø–Ω –∂–∞—Ä“õ –µ—Ç—É—ñ</div>
    <div class="card-sub">
      X_CME.txt –±–æ–π—ã–Ω—à–∞ –∫–µ—à—ñ–≥—É —É–∞“õ—ã—Ç—ã –º–µ–Ω –æ“õ–∏“ì–∞–ª–∞—Ä–¥—ã“£ –ö“Ø–Ω –±–µ—Ç—ñ–Ω–¥–µ  
      “õ–∞–ª–∞–π –±”©–ª—ñ–Ω–µ—Ç—ñ–Ω—ñ–Ω –±–∞“ì–∞–ª–∞–π–¥—ã.
    </div>

    <div id="spikeSummary" style="font-size:0.8rem;margin-bottom:10px;">
      –î–µ—Ä–µ–∫—Ç–µ—Ä –∂“Ø–∫—Ç–µ–ª–≥–µ–Ω —Å–æ“£ –±“±–ª –∂–µ—Ä–¥–µ –∫–µ—à—ñ–≥—É –º–µ–Ω –ö“Ø–Ω –±”©–ª—ñ–∫—Ç–µ—Ä—ñ –±–æ–π—ã–Ω—à–∞ “õ–æ—Ä—ã—Ç—ã–Ω–¥—ã —à—ã“ì–∞–¥—ã.
    </div>

    <!-- –ö“Ø–Ω –º–∞–∫–µ—Ç—ñ —Ñ–æ–Ω—ã –∂”ô–Ω–µ —Ç–æ—Ä –±–∞“ì—ã—Ç—Ç–∞“ì—ã –≥—Ä–∞—Ñ–∏–∫ -->
    <div class="sun-model">
      <div class="sun-model-title">–ö“Ø–Ω –º–∞–∫–µ—Ç—ñ (—Ñ–æ–Ω) –∂”ô–Ω–µ –æ“õ–∏“ì–∞–ª–∞—Ä –∫–∞—Ä—Ç–∞—Å—ã</div>
      <div class="sun-map-wrapper">
        <canvas id="sunRegionMap"></canvas>
        <div class="sun-quadrant-label sun-q-top">–°–æ–ª—Ç“Ø—Å—Ç—ñ–∫ (+Y)</div>
        <div class="sun-quadrant-label sun-q-bottom">–û“£—Ç“Ø—Å—Ç—ñ–∫ (‚àíY)</div>
        <div class="sun-quadrant-label sun-q-left">–ë–∞—Ç—ã—Å (-X)</div>
        <div class="sun-quadrant-label sun-q-right">–®—ã“ì—ã—Å (+X)</div>
      </div>
      <div class="sun-map-axes-label">
        –ö–∞—Ä—Ç–µ–∑–∏–∞–Ω —Ç–æ—Ä: X (—à—ã“ì—ã—Å‚Äì–±–∞—Ç—ã—Å), Y (—Å–æ–ª—Ç“Ø—Å—Ç—ñ–∫‚Äì–æ“£—Ç“Ø—Å—Ç—ñ–∫), –Ω“Ø–∫—Ç–µ–ª–µ—Ä ‚Äì –æ“õ–∏“ì–∞–ª–∞—Ä
      </div>
      <div class="sun-model-caption">
        <div class="legend-item">
          <span class="legend-dot" style="background:#f97316;"></span>
          <span>–ö“Ø–Ω –¥–∏—Å–∫—ñ (—Ñ–æ–Ω)</span>
        </div>
        <div class="legend-item">
          <span class="legend-dot" style="background:#38bdf8;"></span>
          <span>CME –Ω“Ø–∫—Ç–µ–ª–µ—Ä—ñ</span>
        </div>
        <div class="legend-item">
          <span class="legend-dot" style="background:#22c55e;"></span>
          <span>–û—Ä—Ç–∞ –∞–π–º–∞“õ</span>
        </div>
      </div>
      <div style="margin-top:6px;opacity:0.8;">
        –ù“Ø–∫—Ç–µ–ª–µ—Ä coorXm¬∑coorX –∂”ô–Ω–µ coorYm¬∑coorY –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—Ç–∞—Ä—ã –±–æ–π—ã–Ω—à–∞
        —Ç”©—Ä—Ç –±–∞“ì—ã—Ç“õ–∞ (—Å–æ–ª—Ç/–æ“£—Ç/—à—ã“ì/–±–∞—Ç) –±”©–ª—ñ–Ω—ñ–ø –∫”©—Ä—Å–µ—Ç—ñ–ª–µ–¥—ñ.
      </div>
    </div>

    <!-- –¢”ô–∂–¥—ñ–∫ –º–∞—Å—Å–∞ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä—ã -->
    <div class="calc-block">
      <div class="calc-block-title">–¢”ô–∂–¥—ñ–∫ –º–∞—Å—Å–∞–Ω—ã –µ—Å–µ–ø—Ç–µ–π—Ç—ñ–Ω –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä</div>
      <div style="margin-bottom:4px;opacity:0.8;">
        –ö–∏–Ω–µ—Ç–∏–∫–∞–ª—ã“õ —ç–Ω–µ—Ä–≥–∏—è –º–µ–Ω –∂—ã–ª–¥–∞–º–¥—ã“õ –±–µ—Ä—ñ–ª—Å–µ, <i>E = 0.5 ¬∑ m ¬∑ v¬≤</i>
        —Ñ–æ—Ä–º—É–ª–∞—Å—ã–Ω–∞–Ω –º–∞—Å—Å–∞ –µ—Å–µ–ø—Ç–µ–ª–µ–¥—ñ: <i>m = 2E / v¬≤</i>.
      </div>
      <div class="calc-row">
        <label>
          –ö–∏–Ω–µ—Ç–∏–∫–∞–ª—ã“õ —ç–Ω–µ—Ä–≥–∏—è E (—ç—Ä–≥):
          <input type="number" id="calcE" placeholder="–º—ã—Å: 1e31">
        </label>
        <label>
          –ñ—ã–ª–¥–∞–º–¥—ã“õ v (–∫–º/—Å):
          <input type="number" id="calcV" placeholder="–º—ã—Å: 800">
        </label>
      </div>
      <button class="btn-ghost" onclick="calcMass()">–ú–∞—Å—Å–∞–Ω—ã –µ—Å–µ–ø—Ç–µ—É</button>
      <div id="calcResult" class="calc-result">
        –ù”ô—Ç–∏–∂–µ –º“±–Ω–¥–∞ —à—ã“ì–∞–¥—ã.
      </div>
    </div>

    <!-- –ñ–ò —Å–∏—è“õ—Ç—ã –±–æ–ª–∞—à–∞“õ –±–æ–ª–∂–∞–º/“õ–æ—Ä—ã—Ç—ã–Ω–¥—ã -->
    <div class="ai-forecast" id="aiForecast">
      <div class="ai-forecast-title">
        ü§ñ –ñ–ò‚Äì–±–æ–ª–∂–∞–º
        <span class="ai-chip">CME Pattern</span>
      </div>
      <div class="ai-metrics-row" id="aiMetricsRow">
        <!-- –¥–∏–Ω–∞–º–∏–∫–∞–ª—ã“õ –º–µ—Ç—Ä–∏–∫–∞–ª–∞—Ä –º“±–Ω–¥–∞ –∫–µ–ª–µ–¥—ñ -->
      </div>
      <div id="aiForecastText" class="ai-forecast-body">
        –î–µ—Ä–µ–∫—Ç–µ—Ä –∂“Ø–∫—Ç–µ–ª–≥–µ–Ω —Å–æ“£, –ö“Ø–Ω–Ω—ñ“£ –±–µ–ª—Å–µ–Ω–¥—ñ –∞–π–º–∞“õ—Ç–∞—Ä—ã, –æ—Ä—Ç–∞—à–∞ –∫–µ—à—ñ–≥—É —É–∞“õ—ã—Ç—ã
        –∂”ô–Ω–µ —Ç”ô–∂–¥—ñ–∫ –º–∞—Å—Å–∞ –±–æ–π—ã–Ω—à–∞ “õ—ã—Å“õ–∞—à–∞ “õ–æ—Ä—ã—Ç—ã–Ω–¥—ã –º“±–Ω–¥–∞ –∞–≤—Ç–æ–º–∞—Ç—Ç—ã —Ç“Ø—Ä–¥–µ —à—ã“ì–∞–¥—ã.
      </div>
    </div>
  </div>
</main>

<script>
  // =====================================================
  // SME –¥–µ—Ä–µ–∫—Ç–µ—Ä—ñ (–Ω–µ–≥—ñ–∑–≥—ñ TXT): Mass, KE, Speed, Dev
  // =====================================================
  let Date_god = [], Mass = [], KE = [], Speed = [], MassDev = [];
  let maxM = 0, maxKE = 0, maxV = 0;
  let meanM = 0, meanKE = 0, stdM = 0, stdKE = 0;

  // –ö“Ø–Ω –∞–Ω–∏–º–∞—Ü–∏—è—Å—ã
  let idx = 0, playing = false, timer = null;

  // Chart –æ–±—ä–µ–∫—Ç—ñ–ª–µ—Ä—ñ
  let massChart, keChart, speedChart, devChart, corrChart, forecastChart, regionMapChart;

  // X_CME –¥–µ—Ä–µ–∫—Ç–µ—Ä—ñ
  let DelayMinutes = [];   // delta = Time1 - Time2 (–º–∏–Ω—É—Ç–ø–µ–Ω)
  let Intensity = [];      // I = IX * IXX
  let regionCounts = null; // {north, south, east, west, center}
  let regionX = [];        // X –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—Ç–∞—Ä—ã
  let regionY = [];        // Y –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—Ç–∞—Ä—ã

  const statusMessage = document.getElementById("statusMessage");
  const statusText = document.getElementById("statusText");

  function setStatus(type, text) {
    statusMessage.classList.remove("ready", "loading", "error");
    if (type) statusMessage.classList.add(type);
    statusText.textContent = text;
  }

  // =====================================================
  // SME –§–ê–ô–õ–´–ù –û“ö–£
  // =====================================================
  function loadData() {
    const smeFile  = document.getElementById("fileInput").files[0];
    const xcmeFile = document.getElementById("xCmeInput").files[0];

    if (!smeFile) {
      setStatus("error", "SME —Ñ–∞–π–ª—ã —Ç–∞“£–¥–∞–ª–º–∞–¥—ã");
      alert("–ê–ª–¥—ã–º–µ–Ω SME TXT —Ñ–∞–π–ª—ã–Ω —Ç–∞“£–¥–∞.");
      return;
    }

    setStatus("loading", "–§–∞–π–ª–¥–∞—Ä –æ“õ—ã–ª—É–¥–∞...");

    const reader = new FileReader();
    reader.onload = (e) => {
      const lines = e.target.result.split(/\r?\n/).filter(l => l.trim() !== "");

      Date_god = [];
      Mass = [];
      KE = [];
      Speed = [];
      MassDev = [];

      for (const L of lines) {
        const d = L.trim().split(/\s+/);
        if (d.length < 15) continue;

        const god = +d[0];
        const mes = +d[1];
        const den = +d[2];
        const has = +d[3];
        const min = +d[4];
        const sec = +d[5];

        const T = has + min / 60 + sec / 3600;
        const dateYear = god + mes / 12 + den / 365 + T / (24 * 365);

        const speed = +d[8];   // —Å—ã–∑—ã“õ—Ç—ã“õ –∂—ã–ª–¥–∞–º–¥—ã“õ
        const mass  = +d[13];  // –º–∞—Å—Å–∞—Å—ã
        const ke    = +d[14];  // –∫–∏–Ω–µ—Ç–∏–∫–∞–ª—ã“õ —ç–Ω–µ—Ä–≥–∏—è

        Date_god.push(dateYear);
        Speed.push(speed);
        Mass.push(mass);
        KE.push(ke);
      }

      if (Mass.length === 0) {
        setStatus("error", "SME –¥–µ—Ä–µ–≥—ñ —Ç–∞–±—ã–ª–º–∞–¥—ã");
        alert("SME —Ñ–∞–π–ª —Ñ–æ—Ä–º–∞—Ç—ã –∫“Ø—Ç–∫–µ–Ω–≥–µ —Å–∞–π –µ–º–µ—Å (–±–∞“ì–∞–Ω–¥–∞—Ä –∂–µ—Ç—ñ—Å–ø–µ–π–¥—ñ).");
        return;
      }

      maxM = Math.max(...Mass);
      maxKE = Math.max(...KE);
      maxV = Math.max(...Speed);

      meanM = Mass.reduce((a, b) => a + b, 0) / Mass.length;
      meanKE = KE.reduce((a, b) => a + b, 0) / Mass.length;

      stdM = Math.sqrt(Mass.reduce((s, v) => s + (v - meanM) ** 2, 0) / Mass.length);
      stdKE = Math.sqrt(KE.reduce((s, v) => s + (v - meanKE) ** 2, 0) / Mass.length);

      MassDev = Mass.map(m => m - meanM);

      // SME –≥—Ä–∞—Ñ–∏–∫—Ç–µ—Ä—ñ–Ω —Å–∞–ª–∞–º—ã–∑
      plotCoreCharts();
      updateAnimationSummary();

      // –ï–≥–µ—Ä X_CME —Ñ–∞–π–ª—ã –±–∞—Ä –±–æ–ª—Å–∞, –æ–Ω—ã –¥–∞ –æ“õ–∏–º—ã–∑
      if (xcmeFile) {
        readXCMEFile(xcmeFile);
      } else {
        DelayMinutes = [];
        Intensity = [];
        regionCounts = null;
        regionX = [];
        regionY = [];
        plotDelayAndRegionCharts();
        updateRegionSummary();
        updateForecast();
        setStatus("ready", "SME –¥–µ—Ä–µ–∫—Ç–µ—Ä—ñ –¥–∞–π—ã–Ω ‚úÖ (X_CME —Ç–∞“£–¥–∞–ª–º–∞“ì–∞–Ω)");
      }
    };

    reader.onerror = () => {
      setStatus("error", "SME –æ“õ—É “õ–∞—Ç–µ—Å—ñ");
      alert("SME —Ñ–∞–π–ª—ã–Ω –æ“õ—É –∫–µ–∑—ñ–Ω–¥–µ “õ–∞—Ç–µ –∫–µ—Ç—Ç—ñ.");
    };

    reader.readAsText(smeFile);
  }

  // =====================================================
  // X_CME –§–ê–ô–õ–´–ù –û“ö–£
  // =====================================================
  function readXCMEFile(file) {
    const reader2 = new FileReader();
    reader2.onload = (e) => {
      const text = e.target.result;
      parseXCMEText(text);
      plotDelayAndRegionCharts();
      updateRegionSummary();
      updateAnimationSummary();
      updateForecast();
      setStatus("ready", "SME + X_CME –¥–µ—Ä–µ–∫—Ç–µ—Ä—ñ –¥–∞–π—ã–Ω ‚úÖ");
    };
    reader2.onerror = () => {
      setStatus("error", "X_CME –æ“õ—É “õ–∞—Ç–µ—Å—ñ");
      alert("X_CME —Ñ–∞–π–ª—ã–Ω –æ“õ—É –∫–µ–∑—ñ–Ω–¥–µ “õ–∞—Ç–µ –∫–µ—Ç—Ç—ñ.");
    };
    reader2.readAsText(file);
  }

  function parseXCMEText(text) {
    const lines = text.split(/\r?\n/).filter(l => l.trim() !== "");

    DelayMinutes = [];
    Intensity = [];
    regionCounts = { north: 0, south: 0, east: 0, west: 0, center: 0 };
    regionX = [];
    regionY = [];

    for (const L of lines) {
      const dRaw = L.trim().split(/\s+/);
      if (dRaw.length < 17) continue;

      // –ë—ñ—Ä—ñ–Ω—à—ñ —ç–ª–µ–º–µ–Ω—Ç ‚Äì "1." —Å–∏—è“õ—Ç—ã –∏–Ω–¥–µ–∫—Å, —Å–æ–Ω–¥—ã“õ—Ç–∞–Ω –∂—ã–ª 2-—ç–ª–µ–º–µ–Ω—Ç—Ç–µ–Ω:
      let d = dRaw;
      if (dRaw[0].includes(".")) {
        d = dRaw.slice(1);
        if (d.length < 17) continue;
      }

      const has  = parseFloat(d[3]) || 0;
      const min  = parseFloat(d[4]) || 0;
      const sec  = parseFloat(d[5]) || 0;
      const has2 = parseFloat(d[15]) || 0;
      const min2 = parseFloat(d[16]) || 0;

      const coorYm = parseFloat(d[9])  || 0;
      const coorY  = parseFloat(d[10]) || 0;
      const coorXm = parseFloat(d[11]) || 0;
      const coorX  = parseFloat(d[12]) || 0;

      const IXX = parseFloat(d[13]) || 0;
      const IX  = parseFloat(d[14]) || 0;
      const I   = IX * IXX;

      const Time1 = has * 60 + min + sec / 60; // CME —É–∞“õ—ã—Ç—ã, –º–∏–Ω
      const Time2 = has2 * 60 + min2;          // flare –±–∞—Å—Ç–∞–ª—É —É–∞“õ—ã—Ç—ã, –º–∏–Ω
      const delta = Time1 - Time2;             // –∫–µ—à—ñ–≥—É (–º–∏–Ω—É—Ç)

      DelayMinutes.push(delta);
      Intensity.push(I);

      const X = coorXm * coorX;
      const Y = coorYm * coorY;

      regionX.push(X);
      regionY.push(Y);

      const absX = Math.abs(X);
      const absY = Math.abs(Y);
      const centerThreshold = 10; // –≥—Ä–∞–¥—É—Å —ñ—à—ñ–Ω–¥–µ –±–æ–ª—Å–∞ "–æ—Ä—Ç–∞–ª—ã“õ"

      if (absX <= centerThreshold && absY <= centerThreshold) {
        regionCounts.center++;
      } else if (absY >= absX) {
        if (Y > 0) regionCounts.north++;
        else if (Y < 0) regionCounts.south++;
      } else {
        if (X > 0) regionCounts.west++;
        else if (X < 0) regionCounts.east++;
      }
    }
  }

  // =====================================================
  // SME –±–æ–π—ã–Ω—à–∞ “õ—ã—Å“õ–∞—à–∞ “õ–æ—Ä—ã—Ç—ã–Ω–¥—ã + –∫–µ—à—ñ–≥—É —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞—Å—ã
  // =====================================================
  function updateAnimationSummary() {
    const resultsDiv = document.getElementById("results");
    resultsDiv.innerHTML = "";

    if (Mass.length > 0) {
      const iM = Mass.indexOf(maxM);
      const iE = KE.indexOf(maxKE);
      const iV = Speed.indexOf(maxV);

      const p1 = document.createElement("p");
      p1.innerHTML = `<span class="pill-highlight">Max Mass</span> = ${maxM.toExponential(3)} –≥ (T ‚âà ${Date_god[iM].toFixed(2)} –∂—ã–ª)`;
      const p2 = document.createElement("p");
      p2.innerHTML = `<span class="pill-highlight">Max E<sub>kin</sub></span> = ${maxKE.toExponential(3)} —ç—Ä–≥ (T ‚âà ${Date_god[iE].toFixed(2)} –∂—ã–ª)`;
      const p3 = document.createElement("p");
      p3.innerHTML = `<span class="pill-highlight">Max V</span> = ${maxV.toFixed(1)} –∫–º/—Å (T ‚âà ${Date_god[iV].toFixed(2)} –∂—ã–ª)`;
      const p4 = document.createElement("p");
      p4.innerHTML = `–û—Ä—Ç–∞—à–∞ —Ç”ô–∂–¥—ñ–∫ –º–∞—Å—Å–∞: ${meanM.toExponential(3)} –≥`;

      resultsDiv.appendChild(p1);
      resultsDiv.appendChild(p2);
      resultsDiv.appendChild(p3);
      resultsDiv.appendChild(p4);
    }

    if (DelayMinutes.length > 0) {
      const n = DelayMinutes.length;
      const sum = DelayMinutes.reduce((a,b)=>a+b,0);
      const avg = sum / n;
      const minD = Math.min(...DelayMinutes);
      const maxD = Math.max(...DelayMinutes);

      const pLag = document.createElement("p");
      pLag.innerHTML =
        `–ö–µ—à—ñ–≥—É —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞—Å—ã (X_CME): ‚ü®Œît‚ü© ‚âà <b>${avg.toFixed(1)} –º–∏–Ω</b>, ` +
        `–º–∏–Ω: ${minD.toFixed(1)} –º–∏–Ω, –º–∞–∫—Å: ${maxD.toFixed(1)} –º–∏–Ω.`;
      resultsDiv.appendChild(pLag);
    } else {
      const pLag = document.createElement("p");
      pLag.innerHTML = `–ö–µ—à—ñ–≥—É–¥—ñ –∫”©—Ä—É “Ø—à—ñ–Ω X_CME.txt —Ñ–∞–π–ª—ã–Ω –∂“Ø–∫—Ç–µ.`;
      resultsDiv.appendChild(pLag);
    }
  }

  // =====================================================
  // –ö“Ø–Ω –∞–Ω–∏–º–∞—Ü–∏—è—Å—ã
  // =====================================================
  function getSunRegion(m, ke, v) {
    if (m > meanM + 2 * stdM) return "–ö–æ—Ä–æ–Ω–∞ (CME –±–µ–ª—Å–µ–Ω–¥—ñ)";
    if (ke > meanKE + 2 * stdKE) return "–ñ–∞—Ä“õ –µ—Ç—É / flares –∞–π–º–∞“ì—ã";
    if (v > maxV * 0.7) return "–†–∞–¥–∏–∞—Ç–∏–≤—Ç—ñ –∞–π–º–∞“õ";
    if (m > meanM) return "–ö–æ–Ω–≤–µ–∫—Ç–∏–≤—Ç—ñ –∞–π–º–∞“õ";
    return "–§–æ—Ç–æ—Å—Ñ–µ—Ä–∞";
  }

  function animateSun() {
    if (Mass.length === 0) return;

    const m = Mass[idx];
    const ke = KE[idx];
    const v = Speed[idx];

    document.getElementById("yearShow").textContent = Date_god[idx].toFixed(2);

    const sunEl = document.getElementById("sun");
    const coronaEl = document.getElementById("corona");
    const flareEl = document.getElementById("flare");

    const scale = (m / maxM) * 0.8 + 0.4;
    sunEl.style.transform = `scale(${scale})`;
    coronaEl.style.transform = `scale(${1 + scale * 0.4})`;

    const flareAlpha = Math.min(1, (ke / maxKE) * 1.1);
    flareEl.style.background =
      `radial-gradient(circle, rgba(248,113,113,${flareAlpha}), transparent 70%)`;

    const hue = (v / maxV) * 120;
    sunEl.style.filter = `hue-rotate(${hue}deg)`;

    const region = getSunRegion(m, ke, v);
    document.getElementById("regionText").textContent = region;

    idx = (idx + 1) % Mass.length;
  }

  function play() {
    if (!playing) {
      timer = setInterval(animateSun, 100);
      playing = true;
    }
  }

  function pause() {
    clearInterval(timer);
    playing = false;
  }

  function resetAnim() {
    idx = 0;
    pause();
    document.getElementById("yearShow").textContent = "‚Äì";
    document.getElementById("regionText").textContent = "‚Äî";
    document.getElementById("sun").style.transform = "scale(1)";
    document.getElementById("corona").style.transform = "scale(1)";
    document.getElementById("flare").style.background =
      "radial-gradient(circle, rgba(248,113,113,0.0), transparent 70%)";
  }

  // =====================================================
  // CHART.JS ‚Äì 1‚Äì4 –≥—Ä–∞—Ñ–∏–∫ (Mass, KE, Speed, Dev)
  // =====================================================
  function destroyIfExists(ch) {
    if (ch && typeof ch.destroy === "function") ch.destroy();
  }

  function plotCoreCharts() {
    destroyIfExists(massChart);
    destroyIfExists(keChart);
    destroyIfExists(speedChart);
    destroyIfExists(devChart);

    // 1) Mass
    massChart = new Chart(document.getElementById("chartMass"), {
      type: "line",
      data: {
        labels: Date_god,
        datasets: [{
          label: "M(t)",
          data: Mass,
          borderColor: "rgba(34,197,235,1)",
          borderWidth: 1.4,
          pointRadius: 0
        }]
      },
      options: {
        plugins: { legend: { display: false } },
        scales: {
          x: { title: { display: true, text: "T, –∂—ã–ª" } },
          y: { title: { display: true, text: "M, –≥" } }
        }
      }
    });

    // 2) KE
    keChart = new Chart(document.getElementById("chartKE"), {
      type: "line",
      data: {
        labels: Date_god,
        datasets: [{
          label: "E_kin(t)",
          data: KE,
          borderColor: "rgba(249,115,22,1)",
          borderWidth: 1.4,
          pointRadius: 0
        }]
      },
      options: {
        plugins: { legend: { display: false } },
        scales: {
          x: { title: { display: true, text: "T, –∂—ã–ª" } },
          y: { title: { display: true, text: "E_kin, —ç—Ä–≥" } }
        }
      }
    });

    // 3) Speed
    speedChart = new Chart(document.getElementById("chartSpeed"), {
      type: "line",
      data: {
        labels: Date_god,
        datasets: [{
          label: "V(t)",
          data: Speed,
          borderColor: "rgba(250,250,110,1)",
          borderWidth: 1.4,
          pointRadius: 0
        }]
      },
      options: {
        plugins: { legend: { display: false } },
        scales: {
          x: { title: { display: true, text: "T, –∂—ã–ª" } },
          y: { title: { display: true, text: "V, –∫–º/—Å" } }
        }
      }
    });

    // 4) Mass deviation
    devChart = new Chart(document.getElementById("chartMassDev"), {
      type: "line",
      data: {
        labels: Date_god,
        datasets: [{
          label: "M - ‚ü®M‚ü©",
          data: MassDev,
          borderColor: "rgba(129,140,248,1)",
          borderWidth: 1.2,
          pointRadius: 0
        }]
      },
      options: {
        plugins: { legend: { display: false } },
        scales: {
          x: { title: { display: true, text: "T, –∂—ã–ª" } },
          y: { title: { display: true, text: "ŒîM, –≥" } }
        }
      }
    });
  }

  // =====================================================
  // 5‚Äì6 –≥—Ä–∞—Ñ–∏–∫: –∫–µ—à—ñ–≥—É (I vs Œît) –∂”ô–Ω–µ –ö“Ø–Ω –±”©–ª—ñ–∫—Ç–µ—Ä—ñ
  // + –∫“Ø–Ω –º–∞–∫–µ—Ç—ñ —Ñ–æ–Ω—ã–Ω–¥–∞ scatter –∫–∞—Ä—Ç–∞
  // =====================================================
  function plotDelayAndRegionCharts() {
    destroyIfExists(corrChart);
    destroyIfExists(forecastChart);
    destroyIfExists(regionMapChart);

    // 5) I vs delta scatter (–∫–µ—à—ñ–≥—É –≥—Ä–∞—Ñ–∏–≥—ñ)
    if (DelayMinutes.length > 0 && Intensity.length > 0) {
      const points = Intensity.map((I, i) => ({
        x: I,
        y: DelayMinutes[i]
      }));

      corrChart = new Chart(document.getElementById("chartCorr"), {
        type: "scatter",
        data: {
          datasets: [{
            label: "Œît vs I",
            data: points,
            backgroundColor: "rgba(248,113,113,0.8)",
            pointRadius: 2
          }]
        },
        options: {
          plugins: { legend: { display: false } },
          scales: {
            x: {
              title: { display: true, text: "I (–í—Ç/–º2, —à–∞—Ä—Ç—Ç—ã –±—ñ—Ä–ª—ñ–∫)" },
              type: "linear"
            },
            y: {
              title: { display: true, text: "–ö–µ—à—ñ–≥—É Œît, –º–∏–Ω—É—Ç" }
            }
          }
        }
      });
    }

    // 6) –ö“Ø–Ω –±–µ—Ç—ñ–Ω—ñ“£ –±”©–ª—ñ–∫—Ç–µ—Ä—ñ ‚Äì –±–∞—Ä-–¥–∏–∞–≥—Ä–∞–º–º–∞
    if (regionCounts) {
      const labels = [
        "–°–æ–ª—Ç“Ø—Å—Ç—ñ–∫",
        "–û“£—Ç“Ø—Å—Ç—ñ–∫",
        "–®—ã“ì—ã—Å",
        "–ë–∞—Ç—ã—Å",
        "–û—Ä—Ç–∞–ª—ã“õ"
      ];
      const data = [
        regionCounts.north,
        regionCounts.south,
        regionCounts.east,
        regionCounts.west,
        regionCounts.center
      ];

      forecastChart = new Chart(document.getElementById("chartForecast"), {
        type: "bar",
        data: {
          labels,
          datasets: [{
            label: "–û“õ–∏“ì–∞ —Å–∞–Ω—ã",
            data,
            backgroundColor: "rgba(56,189,248,0.8)"
          }]
        },
        options: {
          plugins: { legend: { display: false } },
          scales: {
            x: { title: { display: true, text: "–ö“Ø–Ω –±–µ—Ç—ñ–Ω—ñ“£ –±”©–ª—ñ–≥—ñ" } },
            y: { title: { display: true, text: "–û“õ–∏“ì–∞ —Å–∞–Ω—ã" }, beginAtZero: true }
          }
        }
      });
    }

    // 7) –ö“Ø–Ω –º–∞–∫–µ—Ç—ñ —Ñ–æ–Ω—ã–Ω–¥–∞ X-Y scatter –∫–∞—Ä—Ç–∞ (—Ç–æ—Ä –±–∞“ì—ã—Ç“õ–∞)
    if (regionX.length > 0 && regionY.length > 0) {
      const pts = regionX.map((x, i) => ({
        x,
        y: regionY[i]
      }));

      const maxAbs = Math.max(
        ...regionX.map(v => Math.abs(v)),
        ...regionY.map(v => Math.abs(v)),
        20
      );

      regionMapChart = new Chart(document.getElementById("sunRegionMap"), {
        type: "scatter",
        data: {
          datasets: [{
            label: "CME points",
            data: pts,
            backgroundColor: "rgba(56,189,248,0.95)",
            pointRadius: 2
          }]
        },
        options: {
          plugins: { legend: { display: false } },
          responsive: true,
          maintainAspectRatio: false,
          scales: {
            x: {
              min: -maxAbs,
              max:  maxAbs,
              grid: { color: "rgba(248,250,252,0.25)" },
              ticks: { display: false }
            },
            y: {
              min: -maxAbs,
              max:  maxAbs,
              grid: { color: "rgba(248,250,252,0.25)" },
              ticks: { display: false }
            }
          }
        }
      });
    }
  }

  // =====================================================
  // –ö“Ø–Ω –±”©–ª—ñ–∫—Ç–µ—Ä—ñ –±–æ–π—ã–Ω—à–∞ “õ—ã—Å“õ–∞—à–∞ –º”ô—Ç—ñ–Ω–¥—ñ–∫ “õ–æ—Ä—ã—Ç—ã–Ω–¥—ã
  // =====================================================
  function updateRegionSummary() {
    const div = document.getElementById("spikeSummary");
    if (!div) return;

    if (!regionCounts) {
      div.textContent =
        "–î–µ—Ä–µ–∫—Ç–µ—Ä –∂“Ø–∫—Ç–µ–ª–≥–µ–Ω —Å–æ“£ –±“±–ª –∂–µ—Ä–¥–µ –∫–µ—à—ñ–≥—É –º–µ–Ω –ö“Ø–Ω –±”©–ª—ñ–∫—Ç–µ—Ä—ñ –±–æ–π—ã–Ω—à–∞ “õ–æ—Ä—ã—Ç—ã–Ω–¥—ã —à—ã“ì–∞–¥—ã.";
      return;
    }

    const entries = [
      { key: "north",    label: "–°–æ–ª—Ç“Ø—Å—Ç—ñ–∫ –∂–∞—Ä—Ç—ã—à–∞—Ä" },
      { key: "south",    label: "–û“£—Ç“Ø—Å—Ç—ñ–∫ –∂–∞—Ä—Ç—ã—à–∞—Ä" },
      { key: "east",     label: "–®—ã“ì—ã—Å –±”©–ª—ñ–≥—ñ" },
      { key: "west",     label: "–ë–∞—Ç—ã—Å –±”©–ª—ñ–≥—ñ" },
      { key: "center",   label: "–û—Ä—Ç–∞/–¥–∏—Å–∫—ñ —Ü–µ–Ω—Ç—Ä—ñ" }
    ];

    let maxRegion = entries[0].label;
    let maxVal = regionCounts[entries[0].key];
    let total = 0;

    for (const e of entries) {
      const v = regionCounts[e.key];
      total += v;
      if (v > maxVal) {
        maxVal = v;
        maxRegion = e.label;
      }
    }

    div.innerHTML = `
      <p><b>X_CME –æ“õ–∏“ì–∞–ª–∞—Ä—ã–Ω—ã“£ –ö“Ø–Ω –±–µ—Ç—ñ –±–æ–π—ã–Ω—à–∞ –±”©–ª—ñ–Ω—É—ñ:</b></p>
      <p>–ñ–∞–ª–ø—ã –æ“õ–∏“ì–∞–ª–∞—Ä —Å–∞–Ω—ã: <b>${total}</b></p>
      <ul style="margin:4px 0 4px 16px;padding:0;font-size:0.8rem;">
        <li>–°–æ–ª—Ç“Ø—Å—Ç—ñ–∫ –∂–∞—Ä—Ç—ã—à–∞—Ä: ${regionCounts.north}</li>
        <li>–û“£—Ç“Ø—Å—Ç—ñ–∫ –∂–∞—Ä—Ç—ã—à–∞—Ä: ${regionCounts.south}</li>
        <li>–®—ã“ì—ã—Å –±”©–ª—ñ–≥—ñ: ${regionCounts.east}</li>
        <li>–ë–∞—Ç—ã—Å –±”©–ª—ñ–≥—ñ: ${regionCounts.west}</li>
        <li>–û—Ä—Ç–∞/–¥–∏—Å–∫—ñ —Ü–µ–Ω—Ç—Ä—ñ: ${regionCounts.center}</li>
      </ul>
      <p style="margin-top:4px;">–ï“£ –±–µ–ª—Å–µ–Ω–¥—ñ –∞–π–º–∞“õ: <b>${maxRegion}</b>.</p>
      <p style="margin-top:4px;opacity:0.8;font-size:0.75rem;">
        X –∂”ô–Ω–µ Y –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—Ç–∞—Ä—ã coorXm¬∑coorX, coorYm¬∑coorY —Ä–µ—Ç—ñ–Ω–¥–µ –∞–ª—ã–Ω“ì–∞–Ω.  
        –ë“±–ª ‚Äì —Ç–µ–æ—Ä–∏—è–ª—ã“õ —Å—Ö–µ–º–∞–Ω—ã –∫”©—Ä—Å–µ—Ç—É “Ø—à—ñ–Ω –∂–∞—Å–∞–ª“ì–∞–Ω “õ–∞—Ä–∞–ø–∞–π—ã–º –±”©–ª—É.
      </p>
    `;
  }

  // =====================================================
  // –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä: —Ç”ô–∂–¥—ñ–∫ –º–∞—Å—Å–∞–Ω—ã –µ—Å–µ–ø—Ç–µ—É
  // =====================================================
  function calcMass() {
    const E = parseFloat(document.getElementById("calcE").value);
    const v_km = parseFloat(document.getElementById("calcV").value);
    const out = document.getElementById("calcResult");

    if (isNaN(E) || isNaN(v_km) || v_km === 0) {
      out.textContent = "–ê–ª–¥—ã–º–µ–Ω E –∂”ô–Ω–µ v –º”ô–Ω–¥–µ—Ä—ñ–Ω –¥“±—Ä—ã—Å –µ–Ω–≥—ñ–∑.";
      return;
    }

    // v –∫–º/—Å ‚Üí —Å–º/—Å (1 –∫–º = 1e5 —Å–º)
    const v_cms = v_km * 1e5;
    // E = 0.5 * m * v^2 ‚Üí m = 2E / v^2
    const m = 2 * E / (v_cms * v_cms); // –≥—Ä–∞–º–º–º–µ–Ω
    const m15 = m / 1e15; // 10^15 –≥ —à–∫–∞–ª–∞—Å—ã–Ω–¥–∞

    out.innerHTML =
      `–ï—Å–µ–ø—Ç–µ–ª–≥–µ–Ω —Ç”ô–∂–¥—ñ–∫ –º–∞—Å—Å–∞: <b>${m.toExponential(3)} –≥</b> ` +
      `(‚âà ${m15.toFixed(2)} ¬∑ 10<sup>15</sup> –≥).`;

    updateForecast();
  }

  // =====================================================
  // –ñ–ò‚Äì–±–æ–ª–∂–∞–º (–¥–µ–º–æ): SME + X_CME –Ω–µ–≥—ñ–∑—ñ–Ω–¥–µ “õ—ã—Å“õ–∞—à–∞ “õ–æ—Ä—ã—Ç—ã–Ω–¥—ã
  // =====================================================
  function updateForecast() {
    const el = document.getElementById("aiForecastText");
    const metricsRow = document.getElementById("aiMetricsRow");
    if (!el || !metricsRow) return;

    metricsRow.innerHTML = "";

    if (Mass.length === 0) {
      el.textContent =
        "–ê–ª–¥—ã–º–µ–Ω SME –∂”ô–Ω–µ “õ–∞–∂–µ—Ç –±–æ–ª—Å–∞ X_CME –¥–µ—Ä–µ–∫—Ç–µ—Ä—ñ–Ω –∂“Ø–∫—Ç–µ. –°–æ–Ω–¥–∞ –ñ–ò‚Äì—Ç”ô—Ä—ñ–∑–¥—ñ “õ–æ—Ä—ã—Ç—ã–Ω–¥—ã –∞–≤—Ç–æ–º–∞—Ç—Ç—ã —Ç“Ø—Ä–¥–µ “õ“±—Ä–∞–ª–∞–¥—ã.";
      return;
    }

    // –û—Ä—Ç–∞—à–∞ –∫–µ—à—ñ–≥—É
    let avgDelay = null;
    if (DelayMinutes.length > 0) {
      const sum = DelayMinutes.reduce((a,b)=>a+b,0);
      avgDelay = sum / DelayMinutes.length;
    }

    // –ï“£ –±–µ–ª—Å–µ–Ω–¥—ñ –∞–π–º–∞“õ
    let topRegionText = "–±–µ–ª–≥—ñ—Å—ñ–∑";
    if (regionCounts) {
      const entries = [
        { key: "north",    label: "—Å–æ–ª—Ç“Ø—Å—Ç—ñ–∫ –∂–∞—Ä—Ç—ã—à–∞—Ä" },
        { key: "south",    label: "–æ“£—Ç“Ø—Å—Ç—ñ–∫ –∂–∞—Ä—Ç—ã—à–∞—Ä" },
        { key: "east",     label: "—à—ã“ì—ã—Å –±”©–ª—ñ–≥—ñ" },
        { key: "west",     label: "–±–∞—Ç—ã—Å –±”©–ª—ñ–≥—ñ" },
        { key: "center",   label: "–æ—Ä—Ç–∞–ª—ã“õ –∞–π–º–∞“õ" }
      ];
      let maxRegion = entries[0].label;
      let maxVal = regionCounts[entries[0].key];
      for (const e of entries) {
        const v = regionCounts[e.key];
        if (v > maxVal) {
          maxVal = v;
          maxRegion = e.label;
        }
      }
      topRegionText = maxRegion;
    }

    const massStr = meanM ? meanM.toExponential(3) : "‚Äî";
    const keStr   = meanKE ? meanKE.toExponential(3) : "‚Äî";

    // –ö”©—Ä–Ω–µ–∫—ñ –º–µ—Ç—Ä–∏–∫–∞–ª–∞—Ä (“Ø—Å—Ç—ñ–Ω–¥–µ–≥—ñ —á–∏–ø—Ç–µ—Ä)
    const massMetric = document.createElement("div");
    massMetric.className = "ai-metric";
    massMetric.innerHTML = `‚≠ë ‚ü®M‚ü©: <b>${massStr} –≥</b>`;

    const keMetric = document.createElement("div");
    keMetric.className = "ai-metric";
    keMetric.innerHTML = `‚ö° ‚ü®E<sub>kin</sub>‚ü©: <b>${keStr} —ç—Ä–≥</b>`;

    metricsRow.appendChild(massMetric);
    metricsRow.appendChild(keMetric);

    if (avgDelay !== null) {
      const dMetric = document.createElement("div");
      dMetric.className = "ai-metric";
      dMetric.innerHTML = `‚è± ‚ü®Œît‚ü©: <b>${avgDelay.toFixed(1)} –º–∏–Ω</b>`;
      metricsRow.appendChild(dMetric);
    }

    if (regionCounts) {
      const rMetric = document.createElement("div");
      rMetric.className = "ai-metric";
      rMetric.innerHTML = `‚òÄ –ë–µ–ª—Å–µ–Ω–¥—ñ –∞–π–º–∞“õ: <b>${topRegionText}</b>`;
      metricsRow.appendChild(rMetric);
    }

    let txt = "";
    txt += `–°–æ“£“ì—ã –∂“Ø–∫—Ç–µ–ª–≥–µ–Ω –¥–µ—Ä–µ–∫—Ç–µ—Ä –±–æ–π—ã–Ω—à–∞ –ö“Ø–Ω —Ç”ô–∂–¥—ñ–∫ –º–∞—Å—Å–∞—Å—ã–Ω—ã“£ –æ—Ä—Ç–∞—à–∞ –º”ô–Ω—ñ —à–∞–º–∞–º–µ–Ω <b>${massStr} –≥</b>, ` +
           `–∞–ª –∫–∏–Ω–µ—Ç–∏–∫–∞–ª—ã“õ —ç–Ω–µ—Ä–≥–∏—è–Ω—ã“£ –æ—Ä—Ç–∞—à–∞ –¥–µ“£–≥–µ–π—ñ <b>${keStr} —ç—Ä–≥</b> —à–∞–º–∞—Å—ã–Ω–¥–∞.\n\n`;

    if (avgDelay !== null) {
      txt += `–ö“Ø–Ω –∂–∞—Ä“õ –µ—Ç—É—ñ –º–µ–Ω —Ç”ô–∂–¥—ñ–∫ –º–∞—Å—Å–∞–Ω—ã“£ “±—à—É—ã –∞—Ä–∞—Å—ã–Ω–¥–∞“ì—ã –æ—Ä—Ç–∞—à–∞ –∫–µ—à—ñ–≥—É —É–∞“õ—ã—Ç—ã ` +
             `—à–∞–º–∞–º–µ–Ω <b>${avgDelay.toFixed(1)} –º–∏–Ω—É—Ç</b>. –ë“±–ª –ö“Ø–Ω –±–µ–ª—Å–µ–Ω–¥—ñ–ª—ñ–≥—ñ–Ω—ñ“£ –¥–∞–º—É —Å—Ü–µ–Ω–∞—Ä–∏–π—ñ ` +
             `–±—ñ—Ä–Ω–µ—à–µ –º–∏–Ω—É—Ç —ñ—à—ñ–Ω–¥–µ –∂“Ø—Ä—ñ–ø, —Ç”ô–∂–¥—ñ–∫ “õ“±—Ä—ã–ª—ã–º–¥–∞—Ä–¥—ã“£ “õ–∞–π—Ç–∞ —Ç“Ø–∑—ñ–ª—É—ñ–º–µ–Ω –∞—è“õ—Ç–∞–ª–∞—Ç—ã–Ω—ã–Ω –±—ñ–ª–¥—ñ—Ä–µ–¥—ñ.\n\n`;
    } else {
      txt += `–ö–µ—à—ñ–≥—É —É–∞“õ—ã—Ç—ã (Œît) –±–æ–π—ã–Ω—à–∞ —Ç–æ–ª—ã“õ “õ–æ—Ä—ã—Ç—ã–Ω–¥—ã –∂–∞—Å–∞—É “Ø—à—ñ–Ω X_CME.txt —Ñ–∞–π–ª—ã–Ω “õ–æ—Å—ã–º—à–∞ –∂“Ø–∫—Ç–µ—É “õ–∞–∂–µ—Ç.\n\n`;
    }

    if (regionCounts) {
      txt += `–û“õ–∏“ì–∞–ª–∞—Ä–¥—ã“£ –µ“£ –∫”©–ø —à–æ“ì—ã—Ä–ª–∞–Ω“ì–∞–Ω –∞–π–º–∞“ì—ã ‚Äì <b>${topRegionText}</b>. ` +
             `–û—Å—ã —Å–µ–∫—Ç–æ—Ä–¥–∞ –±–µ–ª—Å–µ–Ω–¥—ñ–ª—ñ–∫ –∂–∏—ñ –±–∞–π“õ–∞–ª–∞—Ç—ã–Ω–¥—ã“õ—Ç–∞–Ω, –±–æ–ª–∞—à–∞“õ—Ç–∞ –¥–∞ CME –æ“õ–∏“ì–∞–ª–∞—Ä—ã–Ω—ã“£ ` +
             `–∫”©–ø—à—ñ–ª—ñ–≥—ñ –¥”ô–ª –æ—Å—ã –±–∞“ì—ã—Ç—Ç–∞ —Ç—ñ—Ä–∫–µ–ª—É—ñ —ã“õ—Ç–∏–º–∞–ª (–ñ–ò‚Äì–Ω–µ–≥—ñ–∑–¥–µ–ª–≥–µ–Ω —Å–∞–ø–∞–ª—ã“õ –±–æ–ª–∂–∞–º).\n\n`;
    }

    txt += `–ë–µ—Ä—ñ–ª–≥–µ–Ω “õ–æ—Ä—ã—Ç—ã–Ω–¥—ã ‚Äî –¥–µ—Ä–µ–∫—Ç–µ—Ä–≥–µ –Ω–µ–≥—ñ–∑–¥–µ–ª–≥–µ–Ω –æ“õ—É‚Äì–¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è–ª—ã“õ –ñ–ò –º–æ–¥–µ–ª—ñ. ` +
           `–ù–∞“õ—Ç—ã “ì–∞—Ä—ã—à—Ç—ã“õ –∞—É–∞ —Ä–∞–π—ã–Ω –±–æ–ª–∂–∞—É “Ø—à—ñ–Ω —Ç–æ–ª—ã“õ —Ñ–∏–∑–∏–∫–∞–ª—ã“õ –º–æ–¥–µ–ª—å–¥–µ—Ä, —Å–ø–µ–∫—Ç—Ä–ª—ñ–∫ –¥–µ—Ä–µ–∫—Ç–µ—Ä ` +
           `–º–µ–Ω “õ–æ—Å—ã–º—à–∞ –±–∞“õ—ã–ª–∞—É–ª–∞—Ä “õ–∞–∂–µ—Ç.`;

    el.innerHTML = txt.replace(/\n/g, "<br>");
  }
</script>

</body>
</html>
